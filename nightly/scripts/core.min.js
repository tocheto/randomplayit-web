var Stage={media:null,mediaTimer:null,bubbles:[],parameters:{MIN_DURATION:15,MAX_DURATION:45,MIN_DELAY:5,MAX_DELAY:50,MAX_BUBBLES:10,DEVICE_WIDTH:300,DEVICE_HEIGHT:500,TWEET_DUR_TIME:2E3,THEME:"zen",RANDOM_TYPE:"random",NUMBER_OF_FRAMES:4,SHOW_WELCOME:1,B_TEXT_SIZE:0},init:function(a){a="undefined";try{a=JSON.parse(localStorage.getItem("parameters"))||"undefined"}catch(b){}"undefined"!=a&&(Stage.parameters=a);Stage.setDeviceDimensions();"default"!=this.parameters.THEME&&Stage.setTheme(null,Stage.parameters.THEME);
$("#startBtn").on("click",function(a){a.preventDefault();Stage.startRandomness(Stage.parameters.RANDOM_TYPE)});$("#loadLocalBtn").on("click",function(a){a.preventDefault();loadLocal()});$(".cloudPosibility").on("click",NC.login);$("#dfltClrBtn").on("click",function(a){a.preventDefault();Stage.applyColor("default")});$("#crntClrBtn").on("click",function(a){a.preventDefault();a=$(".bubble:first").css("color")||"";""!==a&&Stage.applyColor(a)});Stage.parameters.SHOW_WELCOME&&($("#guideBtn").click(),Stage.parameters.SHOW_WELCOME=
0);$("#searchInput").on("keyup",function(){var a=$("#searchInput").val().toLowerCase();3<a.length&&Stage.search(a)});$("#clearSearch").on("click",function(a){a.preventDefault();$("#searchInput").val("");Stage.parameters.RANDOM_TYPE="random"});Stage.adjustFontSize(Stage.parameters.B_TEXT_SIZE);Stage.saveParameters()},refresh:function(){Stage.setDeviceDimensions();Stage.startRandomness(this.parameters.RANDOM_TYPE)},setDeviceDimensions:function(){Stage.parameters.DEVICE_WIDTH=document.documentElement.clientWidth;
Stage.parameters.DEVICE_HEIGHT=document.documentElement.clientHeight},startRandomness:function(a){a=Stage.parameters.RANDOM_TYPE;var b=Stage.bubbles;$(b).velocity("stop");b.forEach(function(a){$(a).remove()});Stage.bubbles=b=[];Stage.generateKeyframes(a,b,"#stage")},generateKeyframes:function(a,b,c){var d,e,f=0,g=Utilities.getColor(Stage.parameters.BUBBLE_COLOR);for(d=0;d<Stage.parameters.MAX_BUBBLES;d++){f=Stage.parameters.TWEET_DUR_TIME;b[d]=Stage.makeBubble(a,g,c);$(b[d]).velocity({translateX:Stage.parameters.DEVICE_WIDTH/
2+"px",translateY:Stage.parameters.DEVICE_HEIGHT+5+"px",opacity:1,translateZ:0},{duration:10,delay:0,loop:!1});for(e=0;e<Stage.parameters.NUMBER_OF_FRAMES;e++)f=Stage.generateRandomFrame(b[d],f);$(b[d]).velocity({opacity:0,translateZ:0,scale:4},{duration:200,loop:!1,complete:Stage.startRandomness})}},makeBubble:function(a,b,c){var d=document.createElement("div");d.style.color=b;$(d).addClass("bubble");b=document.createElement("span");"search"===a?$(b).text(Utilities.getRandomSongKeySearch()):$(b).text(Utilities.getRandomSongKey());
$(d).append(b);$(d).textfill({minFontPixels:0,maxFontPixels:0});$(c).append(d);0<Stage.parameters.B_TEXT_SIZE&&$(d).css("font-size",Stage.parameters.B_TEXT_SIZE);$(d).one("click",MC.playSelectedSong);return d},generateRandomFrame:function(a,b){$(a).velocity({translateX:Utilities.getBubbleX(this.parameters.DEVICE_WIDTH)+"px",translateY:Utilities.getBubbleY(this.parameters.DEVICE_HEIGHT)+"px",translateZ:0},{duration:b,delay:2500,easing:Utilities.getRandomEasing(),loop:!1});return b+Stage.parameters.TWEET_DUR_TIME},
setTheme:function(a,b){var c="",d="",e="";null!=a?(a.preventDefault(),c=b=a.target.id):c=b;(0<=c.indexOf("http://")||0<=c.indexOf("file:///"))&&0<=c.indexOf(".css")?(d="externalThemeCss",e=b):d=c;$("html").removeClass("zen waterfall");console.log("Please wait, loading theme...");"externalThemeCss"===d?$("head").append('<link href="'+e+'" rel="stylesheet" id="'+d+'" />'):$("html").addClass(d);console.log("Theme loaded !");Stage.parameters.THEME!==b&&(Stage.parameters.THEME=c,Stage.saveParameters())},
saveParameters:function(){localStorage.setItem("parameters",JSON.stringify(Stage.parameters))},applyColor:function(a){"default"===a?delete Stage.parameters.BUBBLE_COLOR:Stage.parameters.BUBBLE_COLOR=a;Stage.saveParameters()},adjustFontSize:function(a){0<a?($(".bubble").css("font-size",a),Stage.parameters.B_TEXT_SIZE=a):($(".bubble").css("font-size",""),Stage.parameters.B_TEXT_SIZE=0);Stage.saveParameters()},initSettingsModal:function(){$(".settings").on("click",Stage.setTheme);$("#nmbrBbls").text(Stage.parameters.MAX_BUBBLES);
$("#plusBblsBtn").on("click",function(a){a.preventDefault();30>Stage.parameters.MAX_BUBBLES&&(Stage.parameters.MAX_BUBBLES++,Stage.saveParameters());$("#nmbrBbls").text(Stage.parameters.MAX_BUBBLES)});$("#minusBblsBtn").on("click",function(a){a.preventDefault();0<Stage.parameters.MAX_BUBBLES&&(Stage.parameters.MAX_BUBBLES--,Stage.saveParameters());$("#nmbrBbls").text(Stage.parameters.MAX_BUBBLES)});$("#fntBbls").text(Stage.parameters.B_TEXT_SIZE);$("#plusFntBtn").on("click",function(a){a.preventDefault();
Stage.adjustFontSize(++Stage.parameters.B_TEXT_SIZE);$("#fntBbls").text(Stage.parameters.B_TEXT_SIZE)});$("#minusFntBtn").on("click",function(a){a.preventDefault();Stage.adjustFontSize(--Stage.parameters.B_TEXT_SIZE);$("#fntBbls").text(Stage.parameters.B_TEXT_SIZE)});$("#loadThemeBtn").on("click",function(a){a.preventDefault();a=$("#loadThemeAddr").text()||"";""!=a&&Stage.setTheme(null,a)})},search:function(a){if(""===a)Stage.startRandomness(Stage.parameters.RANDOM_TYPE="random");else{var b=[];for(i in localStorage)"hello"!==
i&&"parameters"!==i&&0<=i.toLowerCase().indexOf(a)&&b.push(i);0!=b.length&&(Stage.parameters.searchResult=b,Stage.parameters.RANDOM_TYPE="search",Stage.startRandomness("search"))}}},Utilities={getColor:function(a){return void 0==a?Utilities.getRandomColor():a},getRandomColor:function(){return"rgb("+parseInt(255*Math.random(),10)+","+parseInt(255*Math.random(),10)+","+parseInt(255*Math.random(),10)+")"},getRandomEasing:function(){var a=["bouncePast","easeInOutBack","swingFromTo"];return a[parseInt(Math.random()*
a.length,10)]},getBubbleX:function(a){return Math.floor(Math.random()*a-30)},getBubbleY:function(a){return Math.floor(Math.random()*(a-60))-120},getRandomSongKey:function(){var a=localStorage.length,a=Math.floor(Math.random()*a),a=localStorage.key(a);return"hello"===a||"parameters"===a?Utilities.getRandomSongKey():a},getRandomSongKeySearch:function(){var a=Stage.parameters.searchResult,b=a.length,b=Math.floor(Math.random()*b),a=a[b];return"hello"===a||"parameters"===a?Utilities.getRandomSongKey():
a}},MC={keyActions:[],iPadUseNativeControls:!0,iPhoneUseNativeControls:!0,AndroidUseNativeControls:!0,enableAutosize:!1,features:["playpause","progress","current","volume"],init:function(){$("video,audio").mediaelementplayer({success:function(a,b){a.addEventListener("ended",function(a){MC.playRandomSong(a.target)},!1)},keyActions:MC.keyActions,iPadUseNativeControls:MC.iPadUseNativeControls,iPhoneUseNativeControls:MC.iPhoneUseNativeControls,AndroidUseNativeControls:MC.AndroidUseNativeControls,enableAutosize:MC.enableAutosize,
features:MC.features})},playSelectedSong:function(a){var b=$(this).text();MC.retrievePathAndPlay(b,localStorage[b]);a&&a.preventDefault()},playSong:function(a,b){"undefined"===a&&(a=$("audio#mejs:first")[0]);a.player.pause();a.player.setSrc(b);a.player.play()},playRandomSong:function(a){a="";a="search"==Stage.parameters.RANDOM_TYPE?Utilities.getRandomSongKeySearch():Utilities.getRandomSongKey();MC.retrievePathAndPlay(a,localStorage[a])},retrievePathAndPlay:function(a,b){var c=$.parseJSON(b),d=c.provider,
c=c.id;"local"===d?MC.playSong("undefined",c):NC.getNetworkLink(d,c)}},NC={init:function(){hello.init({google:"550306267493-5jcdcdg55ffe9hlkt5gruk8mv5mb8ppd.apps.googleusercontent.com",windows:"0000000040136FF4",dropbox:"fdov2qv0majt9nk",soundcloud:"46d8abdf4419023d86776f6c735f02b4","4shared":"8e319df9f196364b706e34fe10620354"},{redirect_uri:"./redirect.html"})},login:function(a){a=this.id;switch(a){case "dropbox":hello("dropbox").login(NC.retrieveList);break;case "gdrive":hello("google").login(NC.retrieveList);
break;case "onedrive":hello("windows").login(NC.retrieveList);break;case "soundcloud":hello("soundcloud").login(NC.retrieveList);break;case "4shared":hello("4shared").login(NC.retrieveList)}},autoLogin:function(a){hello(a).login({force:!1}).then(NC.retrieveList)},retrieveList:function(a){switch(a.network){case "dropbox":hello(a.network).api("audio").on("complete",NC.listItemsDropbox);break;case "google":hello(a.network).api("audio").on("complete",NC.listItemsGdrive);break;case "windows":hello(a.network).api("audio").on("complete",
NC.listItemsOnedrive);break;case "soundcloud":hello(a.network).api("audio").on("complete",NC.listItemsSoundcloud);break;case "4shared":hello(a.network).api("audio").on("complete",NC.listItems4shared)}},listItemsDropbox:function(a){if(!a.error)for(var b in a)if(!0===a[b].is_dir)hello("dropbox").api("metadata/dropbox/"+a[b].path).on("complete",NC.listItemsDropbox);else if(-1!=a[b].mime_type.indexOf("audio")&&-1!=a[b].size.indexOf("MB")){var c=a[b].path.split("/").pop().replace(/\_/g," ");localStorage.setItem(c,
'{"provider":"dropbox", "id":"'+a[b].path+'"}')}},listItemsGdrive:function(a){for(var b in a.items){var c='{"provider":"google", "id":"'+a.items[b].id+'"}';localStorage.setItem(a.items[b].title.replace(/\_/g," "),c)}},listItemsOnedrive:function(a){for(item=0;item<a.data.length;item++)if("folder"===a.data[item].type)hello("windows").api(a.data[item].id+"/files?filter=audio,folders").on("complete",NC.listItemsOnedrive);else{var b='{"provider":"windows", "id":"'+a.data[item].id+'"}';localStorage.setItem(a.data[item].name.replace(/\_/g,
" "),b)}},listItemsSoundcloud:function(a){for(item=0;item<a.data.length;item++){var b=a.data[item].tracks;for(track=0;track<b.length;track++){var c='{"provider":"soundcloud", "id":"'+b[track].id+'"}';localStorage.setItem(b[track].title.replace(/\_/g," "),c)}}},listItems4shared:function(a){for(item=0;item<a.files.length;item++){var b='{"provider":"4shared", "id":"'+a.files[item].id+'"}';localStorage.setItem(a.files[item].name.replace(/\_/g," "),b)}},getNetworkLink:function(a,b){var c=(hello.utils.store(a)||
{}).access_token||"undefined";switch(a){case "dropbox":hello("dropbox").login({force:!1,display:"none"}).then(function(){hello("dropbox").api("media/dropbox"+b).then(function(a){MC.playSong("undefined",a.url+"?access_token="+c)})});break;case "google":hello("google").login({force:!1,display:"none"}).then(function(){hello("google").api("drive/v2/files/"+b+"?fields=downloadUrl").then(function(a){MC.playSong("undefined",a.downloadUrl+"&access_token="+c)})});break;case "windows":hello("windows").login({force:!1,
display:"none"}).then(function(){hello("windows").api(b+"/content?download=true&suppress_redirects=true").then(function(a){MC.playSong("undefined",a.location+"&access_token="+c)})});break;case "soundcloud":hello("soundcloud").login({force:!1}).then(function(){MC.playSong("undefined","https://api.soundcloud.com/tracks/"+b+"/stream?oauth_token="+c)});break;case "4shared":hello("4shared").login({force:!1,display:"none"}).then(function(){hello("4shared").api("files/"+b+".jsonp").then(function(a){MC.playSong("undefined",
a.downloadUrl)})})}}};$(document).ready(function(){Stage.init();MC.init();NC.init()});window.onresize=function(a){Stage.refresh()};
