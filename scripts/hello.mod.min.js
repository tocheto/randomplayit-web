/*
 Andrew Dodson, 2012 - 2013
 @license MIT: You are free to use and modify this code for any use, on the condition that this copyright notice remains.
*/
var hello=function(b){return hello.use(b)};hello.utils={extend:function(b){for(var c=Array.prototype.slice.call(arguments,1),a=0;a<c.length;a++){var e=c[a];if(b instanceof Object&&e instanceof Object&&b!==e)for(var g in e)b[g]=hello.utils.extend(b[g],e[g]);else b=e}return b}};
hello.utils.extend(hello,{settings:{redirect_uri:window.location.href.split("#")[0],response_type:"token",display:"popup",state:"",oauth_proxy:"https://auth-server.herokuapp.com/proxy",timeout:2E4,default_service:null,force:!1,page_uri:window.location.href},service:function(b){return"undefined"!==typeof b?this.utils.store("sync_service",b):this.utils.store("sync_service")},services:{},use:function(b){var c=this.utils.objectCreate(this);c.settings=this.utils.objectCreate(this.settings);b&&(c.settings.default_service=
b);c.utils.Event.call(c);return c},init:function(b,c){var a=this.utils;if(!b)return this.services;for(var e in b)b.hasOwnProperty(e)&&"object"!==typeof b[e]&&(b[e]={id:b[e]});a.extend(this.services,b);for(e in this.services)this.services.hasOwnProperty(e)&&(this.services[e].scope=this.services[e].scope||{});c&&(a.extend(this.settings,c),"redirect_uri"in c&&(this.settings.redirect_uri=a.url(c.redirect_uri).href));return this},login:function(){var b=this.use(),c=b.utils,a=c.args({network:"s",options:"o",
callback:"f"},arguments);b.args=a;var e,g=a.options=c.merge(b.settings,a.options||{});a.network=b.settings.default_service=a.network||b.settings.default_service;b.on("complete",a.callback);if("string"!==typeof a.network||!(a.network in b.services))return b.emitAfter("error complete",{error:{code:"invalid_network",message:"The provided network was not recognized"}}),b;var d=b.services[a.network],h=!1,f=c.globalEvent(function(a){a=a?JSON.parse(a):{error:{code:"cancelled",message:"The authentication was not completed"}};
h=!0;a.error?b.emit("complete error failed auth.failed",{error:a.error}):(c.store(a.network,a),b.emit("complete success login auth.login auth",{network:a.network,authResponse:a}))}),k=c.url(g.redirect_uri).href;e=d.oauth.response_type||g.response_type;"code"!==e||d.oauth.grant||(e="token");a.qs={client_id:d.id,response_type:e,redirect_uri:k,display:g.display,scope:"basic",state:{client_id:d.id,network:a.network,display:g.display,callback:f,state:g.state,redirect_uri:k}};"dropbox"===a.network&&(a.qs=
{client_id:d.id,response_type:e,redirect_uri:k,scope:"basic",state:{client_id:d.id,network:a.network,display:g.display,callback:f,state:g.state,redirect_uri:k}});var f=c.store(a.network),n=(g.scope||"").toString(),n=(n?n+",":"")+a.qs.scope;f&&"scope"in f&&f.scope instanceof String&&(n+=","+f.scope);a.qs.state.scope=c.unique(n.split(/[,\s]+/)).join(",");a.qs.scope=n.replace(/[^,\s]+/ig,function(a){if(a in d.scope)return d.scope[a];for(var c in b.services){var e=b.services[c].scope;if(e&&a in e)return""}return a}).replace(/[,\s]+/ig,
",");a.qs.scope=c.unique(a.qs.scope.split(/,+/)).join(d.scope_delim||",");if(!1===g.force&&f&&"access_token"in f&&f.access_token&&"expires"in f&&f.expires>(new Date).getTime()/1E3&&0===c.diff(f.scope||[],a.qs.state.scope||[]).length)return b.emitAfter("complete success login",{unchanged:!0,network:a.network,authResponse:f}),b;"page"===g.display&&g.page_uri&&(a.qs.state.page_uri=c.url(g.page_uri).href);"login"in d&&"function"===typeof d.login&&d.login(a);if("token"!==e||2>parseInt(d.oauth.version,
10)||"none"===g.display&&d.oauth.grant&&f&&f.refresh_token)a.qs.state.oauth=d.oauth,a.qs.state.oauth_proxy=g.oauth_proxy;a.qs.state=JSON.stringify(a.qs.state);1===parseInt(d.oauth.version,10)?e=c.qs(g.oauth_proxy,a.qs):"none"===g.display&&d.oauth.grant&&f&&f.refresh_token?(a.qs.refresh_token=f.refresh_token,e=c.qs(g.oauth_proxy,a.qs)):e=c.qs(d.oauth.auth,a.qs);b.emit("notice","Authorization URL "+e);if("none"===g.display)c.iframe(e);else if("popup"===g.display)var l=c.popup(e,k,g.window_width||500,
g.window_height||550),m=setInterval(function(){if(!l||l.closed)if(clearInterval(m),!h){var c={code:"cancelled",message:"Login has been cancelled"};l||(c={code:"blocked",message:"Popup was blocked"});b.emit("complete failed error",{error:c,network:a.network})}},100);else window.location=e;return b},logout:function(){var b=this.use(),c=b.utils,a=c.args({name:"s",options:"o",callback:"f"},arguments);a.options=a.options||{};b.on("complete",a.callback);a.name=a.name||b.settings.default_service;if(!a.name||
a.name in b.services)if(a.name&&c.store(a.name)){var e=function(c){b.utils.store(a.name,"");b.emitAfter("complete logout success auth.logout auth",hello.utils.merge({network:a.name},c||{}))},g={};if(a.options.force){var d=b.services[a.name].logout;if(d)if("function"===typeof d&&(d=d(e)),"string"===typeof d)c.iframe(d),g.force=null,g.message="Logout success on providers site was indeterminate";else if(void 0===d)return b}e(g)}else if(a.name)b.emitAfter("complete error",{error:{code:"invalid_session",
message:"There was no session to remove"}});else{for(e in b.services)b.services.hasOwnProperty(e)&&b.logout(e);b.service(!1)}else b.emitAfter("complete error",{error:{code:"invalid_network",message:"The network was unrecognized"}});return b},getAuthResponse:function(b){b=b||this.settings.default_service;return b&&b in this.services?this.utils.store(b)||null:(this.emit("complete error",{error:{code:"invalid_network",message:"The network was unrecognized"}}),null)},events:{}});
hello.utils.extend(hello.utils,{qs:function(b,c){if(c){var a,e;for(e in c)-1<b.indexOf(e)&&(a=new RegExp("[\\?\\&]"+e+"=[^\\&]*"),b=b.replace(a,""))}return b+(this.isEmpty(c)?"":(-1<b.indexOf("?")?"&":"?")+this.param(c))},param:function(b){var c={},a;if("string"===typeof b){if(a=b.replace(/^[\#\?]/,"").match(/([^=\/\&]+)=([^\&]+)/g))for(var e=0;e<a.length;e++)b=a[e].match(/([^=]+)=(.*)/),c[b[1]]=decodeURIComponent(b[2]);return c}c=[];for(a in b)b.hasOwnProperty(a)&&b.hasOwnProperty(a)&&c.push([a,
"?"===b[a]?"?":encodeURIComponent(b[a])].join("="));return c.join("&")},store:function(b){var c=[b,window.sessionStorage],a=0;for(b=c[a++];b;)try{b.setItem(a,a);b.removeItem(a);break}catch(e){b=c[a++]}b||(b={getItem:function(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){var e=b[c].replace(/(^\s+|\s+$)/,"");if(e&&0===e.indexOf(a))return e.substr(a.length)}return null},setItem:function(a,b){document.cookie=a+"="+b}});return function(a,c,e){e={};try{e=JSON.parse(b.getItem("hello"))||
{}}catch(f){}if(a&&void 0===c)return e[a]||null;if(a&&null===c)try{delete e[a]}catch(k){e[a]=null}else if(a)e[a]=c;else return e;b.setItem("hello",JSON.stringify(e));return e||null}}(window.localStorage),append:function(b,c,a){var e="string"===typeof b?document.createElement(b):b;if("object"===typeof c)if("tagName"in c)a=c;else for(var g in c)if(c.hasOwnProperty(g))if("object"===typeof c[g])for(var d in c[g])c[g].hasOwnProperty(d)&&(e[g][d]=c[g][d]);else"html"===g?e.innerHTML=c[g]:/^on/.test(g)?e[g]=
c[g]:e.setAttribute(g,c[g]);"body"===a?function f(){document.body?document.body.appendChild(e):setTimeout(f,16)}():"object"===typeof a?a.appendChild(e):"string"===typeof a&&document.getElementsByTagName(a)[0].appendChild(e);return e},iframe:function(b){this.append("iframe",{src:b,style:{position:"absolute",left:"-1000px",bottom:0,height:"1px",width:"1px"}},"body")},merge:function(){var b=Array.prototype.slice.call(arguments);b.unshift({});return this.extend.apply(null,b)},args:function(b,c){var a=
{},e=0,g=null,d=null;for(d in b)if(b.hasOwnProperty(d))break;if(1===c.length&&"object"===typeof c[0]&&"o!"!=b[d])for(d in c[0])if(b.hasOwnProperty(d)&&d in b)return c[0];for(d in b)if(b.hasOwnProperty(d))if(g=typeof c[e],"function"===typeof b[d]&&b[d].test(c[e])||"string"===typeof b[d]&&(-1<b[d].indexOf("s")&&"string"===g||-1<b[d].indexOf("o")&&"object"===g||-1<b[d].indexOf("i")&&"number"===g||-1<b[d].indexOf("a")&&"object"===g||-1<b[d].indexOf("f")&&"function"===g))a[d]=c[e++];else if("string"===
typeof b[d]&&-1<b[d].indexOf("!"))return!1;return a},url:function(b){if(b){if(window.URL&&URL instanceof Function&&0!==URL.length)return new URL(b,window.location);var c=document.createElement("a");c.href=b;return c}return window.location},diff:function(b,c){for(var a=[],e=0;e<c.length;e++)-1===this.indexOf(b,c[e])&&a.push(c[e]);return a},indexOf:function(b,c){if(b.indexOf)return b.indexOf(c);for(var a=0;a<b.length;a++)if(b[a]===c)return a;return-1},unique:function(b){if("object"!==typeof b)return[];
for(var c=[],a=0;a<b.length;a++)b[a]&&0!==b[a].length&&-1===this.indexOf(c,b[a])&&c.push(b[a]);return c},isEmpty:function(b){if(!b)return!0;if(b&&0<b.length)return!1;if(b&&0===b.length)return!0;for(var c in b)if(b.hasOwnProperty(c))return!1;return!0},objectCreate:function(){function b(){}return Object.create?Object.create:function(c){if(1!=arguments.length)throw Error("Object.create implementation only accepts one parameter.");b.prototype=c;return new b}}(),Event:function(){var b=/[\s\,]+/;this.parent=
{events:this.events,findEvents:this.findEvents,parent:this.parent,utils:this.utils};this.events={};this.on=function(c,a){if(a&&"function"===typeof a)for(var e=c.split(b),g=0;g<e.length;g++)this.events[e[g]]=[a].concat(this.events[e[g]]||[]);return this};this.off=function(b,a){this.findEvents(b,function(b,c){a&&this.events[b][c]!==a||(this.events[b][c]=null)});return this};this.emit=function(b){var a=Array.prototype.slice.call(arguments,1);a.push(b);for(var e=function(e,g){a[a.length-1]="*"===e?b:
e;this.events[e][g].apply(this,a)},g=this;g&&g.findEvents;)g.findEvents(b+",*",e),g=g.parent;return this};this.emitAfter=function(){var b=this,a=arguments;setTimeout(function(){b.emit.apply(b,a)},0);return this};this.findEvents=function(c,a){var e=c.split(b),g;for(g in this.events)if(this.events.hasOwnProperty(g)&&-1<hello.utils.indexOf(e,g))for(var d=0;d<this.events[g].length;d++)this.events[g][d]&&a.call(this,g,d)};return this},globalEvent:function(b,c){c=c||"_hellojs_"+parseInt(1E12*Math.random(),
10).toString(36);window[c]=function(){try{bool=b.apply(this,arguments)}catch(a){console.error(a)}if(bool)try{delete window[c]}catch(e){}};return c},popup:function(b,c,a,e){var g=document.documentElement,d=((window.innerWidth||g.clientWidth||screen.width)-a)/2+(void 0!==window.screenLeft?window.screenLeft:screen.left),h=((window.innerHeight||g.clientHeight||screen.height)-e)/2+(void 0!==window.screenTop?window.screenTop:screen.top),f=function(b){var g=window.open(b,"_blank","resizeable=true,height="+
e+",width="+a+",left="+d+",top="+h);if(g&&g.addEventListener){b=hello.utils.url(c);var l=b.origin||b.protocol+"//"+b.hostname;g.addEventListener("loadstart",function(a){a=a.url;0===a.indexOf(l)&&(a=hello.utils.url(a),a={location:{assign:function(a){g.addEventListener("exit",function(){setTimeout(function(){f(a)},1E3)})},search:a.search,hash:a.hash,href:a.href},close:function(){g.close&&g.close()}},hello.utils.responseHandler(a,window),a.close())})}g&&g.focus&&g.focus();return g};-1!==navigator.userAgent.indexOf("Safari")&&
-1===navigator.userAgent.indexOf("Chrome")&&(b=c+"#oauth_redirect="+encodeURIComponent(encodeURIComponent(b)));return f(b)},responseHandler:function(b,c){function a(a,b,c){g.store(a.network,a);if(!("display"in a&&"page"===a.display)){if(c){b=a.callback;try{delete a.callback}catch(d){}g.store(a.network,a);if(b in c){a=JSON.stringify(a);try{c[b](a)}catch(f){}}}e()}}function e(){try{b.close()}catch(a){}b.addEventListener&&b.addEventListener("load",function(){b.close()})}var g=this,d,h=b.location,f=function(a){h.assign?
h.assign(a):b.location=a};if((d=g.param(h.search))&&(d.code&&d.state||d.oauth_token&&d.proxy_url)){var k=JSON.parse(d.state);d.redirect_uri=k.redirect_uri||h.href.replace(/[\?\#].*$/,"");d=(k.oauth_proxy||d.proxy_url)+"?"+g.param(d);f(d)}else if((d=g.merge(g.param(h.search||""),g.param(h.hash||"")))&&"state"in d){try{k=JSON.parse(d.state),g.extend(d,k)}catch(n){console.error("Could not decode state parameter")}"access_token"in d&&d.access_token&&d.network?(d.expires_in&&0!==parseInt(d.expires_in,
10)||(d.expires_in=0),d.expires_in=parseInt(d.expires_in,10),d.expires=(new Date).getTime()/1E3+(d.expires_in||31536E3),a(d,b,c)):"error"in d&&d.error&&d.network?(d.error={code:d.error,message:d.error_message||d.error_description},a(d,b,c)):d.callback&&d.callback in c&&(f="result"in d&&d.result?JSON.parse(d.result):!1,c[d.callback](f),e());d.page_uri&&(b.location=d.page_uri)}else"oauth_redirect"in d&&f(decodeURIComponent(d.oauth_redirect))}});hello.utils.Event.call(hello);hello.subscribe=hello.on;
hello.trigger=hello.emit;hello.unsubscribe=hello.off;hello.utils.responseHandler(window,window.opener||window.parent);
(function(b){var c={},a={};b.on("auth.login, auth.logout",function(a){a&&"object"===typeof a&&a.network&&(c[a.network]=b.utils.store(a.network)||{})});(function g(){var d=(new Date).getTime()/1E3,h=function(a){b.emit("auth."+a,{network:f,authResponse:k})},f;for(f in b.services)if(b.services.hasOwnProperty(f)&&b.services[f].id){var k=b.utils.store(f)||{},n=b.services[f],l=c[f]||{};if(k&&"callback"in k){var m=k.callback;try{delete k.callback}catch(s){}b.utils.store(f,k);try{window[m](k)}catch(r){}}if(k&&
"expires"in k&&k.expires<d)!(n=n.refresh||k.refresh_token)||f in a&&!(a[f]<d)?n||f in a||(h("expired"),a[f]=!0):(b.emit("notice",f+" has expired trying to resignin"),b.login(f,{display:"none",force:!1}),a[f]=d+600);else if(l.access_token!==k.access_token||l.expires!==k.expires)!k.access_token&&l.access_token?h("logout"):k.access_token&&!l.access_token?h("login"):k.expires!==l.expires&&h("update"),c[f]=k,f in a&&delete a[f]}setTimeout(g,1E3)})()})(hello);
hello.api=function(){function b(b){b=b.replace(/\@\{([a-z\_\-]+)(\|.+?)?\}/gi,function(b,e,d){b=d?d.replace(/^\|/,""):"";e in a.query?(b=a.query[e],delete a.query[e]):d||c("missing_attribute","The attribute "+e+" is missing from the request");return b});b.match(/^https?:\/\//)||(b=f.base+b);a.url=b;g.request(a,function(b,c){!0===b?b={success:!0}:b||(b={});"delete"===a.method&&(b=!b||g.isEmpty(b)?{success:!0}:b);if(f.wrap&&(a.path in f.wrap||"default"in f.wrap)){var d=a.path in f.wrap?a.path:"default";
(new Date).getTime();(d=f.wrap[d](b,c,a))&&(b=d)}b&&"paging"in b&&b.paging.next&&(b.paging.next="?"===b.paging.next[0]?a.path+b.paging.next:b.paging.next+("#"+a.path));e.emit("complete "+(!b||"error"in b?"error":"success"),b)})}function c(a,b){return e.emitAfter("complete error",{error:{code:a,message:b}})}var a=this.utils.args({path:"s!",query:"o",method:"s",data:"o",timeout:"i",callback:"f"},arguments),e=this.use(),g=e.utils;e.args=a;a.method=(a.method||"get").toLowerCase();a.headers=a.headers||
{};a.query=a.query||{};if("get"===a.method||"delete"===a.method)g.extend(a.query,a.data),a.data={};var d=a.data=a.data||{};e.on("complete",a.callback);if(!a.path)return c("invalid_path","Missing the path parameter from the request");a.path=a.path.replace(/^\/+/,"");var h=(a.path.split(/[\/\:]/,2)||[])[0].toLowerCase();h in e.services&&(a.network=h,a.path=a.path.replace(new RegExp("^"+h+":?/?"),""));a.network=e.settings.default_service=a.network||e.settings.default_service;var f=e.services[a.network];
if(!f)return c("invalid_network","Could not match the service requested: "+a.network);if(a.method in f&&a.path in f[a.method]&&!1===f[a.method][a.path])return c("invalid_path","The provided path is not available on the selected network");a.oauth_proxy||(a.oauth_proxy=e.settings.oauth_proxy);"proxy"in a||(a.proxy=a.oauth_proxy&&f.oauth&&1===parseInt(f.oauth.version,10));"timeout"in a||(a.timeout=e.settings.timeout);"onuploadprogress"in a||(a.onuploadprogress=function(a){e.emit("uploadprogress",a)});
"onprogress"in a||(a.onprogress=function(a){e.emit("progress",a)});(h=e.getAuthResponse(a.network))&&h.access_token&&(a.query.access_token=h.access_token);var h=a.path,k;a.options=g.clone(a.query);a.data=g.clone(d);d=f[{"delete":"del"}[a.method]||a.method]||{};"get"===a.method&&(k=h.split(/[\?#]/)[1])&&(g.extend(a.query,g.param(k)),h=h.replace(/\?.*?(#|$)/,"$1"));(k=h.match(/#(.+)/,""))?(h=h.split("#")[0],a.path=k[1]):h in d?(a.path=h,h=d[h]):"default"in d&&(h=d["default"]);a.redirect_uri=e.settings.redirect_uri;
a.oauth=f.oauth;a.xhr=f.xhr;a.jsonp=f.jsonp;a.form=f.form;"function"===typeof h?h(a,b):b(h);return e};
hello.utils.extend(hello.utils,{request:function(b,c){function a(a,b){var c;a.oauth&&1===parseInt(a.oauth.version,10)&&(c=a.query.access_token,delete a.query.access_token,a.proxy=!0);!a.data||"get"!==a.method&&"delete"!==a.method||(e.extend(a.query,a.data),a.data=null);var d=e.qs(a.url,a.query);a.proxy&&(d=e.qs(a.oauth_proxy,{path:d,access_token:c||"",then:"get"===a.method.toLowerCase()?"redirect":"proxy",method:a.method.toLowerCase(),suppress_response_codes:!0}));b(d)}var e=this;e.isEmpty(b.data)||
"FileList"in window||!e.hasBinary(b.data)||(b.xhr=!1,b.jsonp=!1);if("withCredentials"in new XMLHttpRequest&&(!("xhr"in b)||b.xhr&&("function"!==typeof b.xhr||b.xhr(b,b.query))))a(b,function(a){a=e.xhr(b.method,a,b.headers,b.data,c);a.onprogress=b.onprogress||null;a.upload&&b.onuploadprogress&&(a.upload.onprogress=b.onuploadprogress)});else{var g=b.query;b.query=e.clone(b.query);b.callbackID=e.globalEvent();if(!1!==b.jsonp){b.query.callback=b.callbackID;"function"===typeof b.jsonp&&b.jsonp(b,b.query);
if("get"===b.method){a(b,function(a){e.jsonp(a,c,b.callbackID,b.timeout)});return}b.query=g}if(!1!==b.form){b.query.redirect_uri=b.redirect_uri;b.query.state=JSON.stringify({callback:b.callbackID});var d;"function"===typeof b.form&&(d=b.form(b,b.query));if("post"===b.method&&!1!==d){a(b,function(a){e.post(a,b.data,d,c,b.callbackID,b.timeout)});return}}c({error:{code:"invalid_request",message:"There was no mechanism for handling this request"}})}},isArray:function(b){return"[object Array]"===Object.prototype.toString.call(b)},
domInstance:function(b,c){var a="HTML"+(b||"").replace(/^[a-z]/,function(a){return a.toUpperCase()})+"Element";return c?window[a]?c instanceof window[a]:window.Element?c instanceof window.Element&&(!b||c.tagName&&c.tagName.toLowerCase()===b):!(c instanceof Object||c instanceof Array||c instanceof String||c instanceof Number)&&c.tagName&&c.tagName.toLowerCase()===b:!1},clone:function(b){if(null===b||"object"!==typeof b||b instanceof Date||"nodeName"in b||this.isBinary(b))return b;var c;if(this.isArray(b)){c=
[];for(var a=0;a<b.length;a++)c.push(this.clone(b[a]));return c}c={};for(a in b)c[a]=this.clone(b[a]);return c},xhr:function(b,c,a,e,g){var d=new XMLHttpRequest,h=!1;"blob"===b&&(h=b,b="GET");b=b.toUpperCase();d.onload=function(a){a=d.response;try{a=JSON.parse(d.responseText)}catch(c){401===d.status&&(a={error:{code:"access_denied",message:d.statusText}})}for(var e=d.getAllResponseHeaders(),f={},k=/([a-z\-]+):\s?(.*);?/gi,h;h=k.exec(e);)f[h[1]]=h[2];f.statusCode=d.status;g(a||("GET"===b?{error:{code:"empty_response",
message:"Could not get resource"}}:{}),f)};d.onerror=function(a){a=d.responseText;try{a=JSON.parse(d.responseText)}catch(b){}g(a||{error:{code:"access_denied",message:"Could not get resource"}})};var f;if("GET"===b||"DELETE"===b)e=null;else if(!(!e||"string"===typeof e||e instanceof FormData||e instanceof File||e instanceof Blob)){var k=new FormData;for(f in e)e.hasOwnProperty(f)&&(e[f]instanceof HTMLInputElement?"files"in e[f]&&0<e[f].files.length&&k.append(f,e[f].files[0]):e[f]instanceof Blob?k.append(f,
e[f],e.name):k.append(f,e[f]));e=k}d.open(b,c,!0);h&&("responseType"in d?d.responseType=h:d.overrideMimeType("text/plain; charset=x-user-defined"));if(a)for(f in a)d.setRequestHeader(f,a[f]);d.send(e);return d},jsonp:function(b,c,a,e){var g=0,d=document.getElementsByTagName("head")[0],h,f,k={error:{message:"server_error",code:"server_error"}},n=function(){g++||window.setTimeout(function(){c(k);d.removeChild(f)},0)};a=this.globalEvent(function(a){k=a;return!0},a);b=b.replace(/=\?(&|$)/,"="+a+"$1");
f=this.append("script",{id:a,name:a,src:b,async:!0,onload:n,onerror:n,onreadystatechange:function(){/loaded|complete/i.test(this.readyState)&&n()}});-1<window.navigator.userAgent.toLowerCase().indexOf("opera")&&(h=this.append("script",{text:"document.getElementById('"+cb_name+"').onerror();"}),f.async=!1);e&&window.setTimeout(function(){k={error:{message:"timeout",code:"timeout"}};n()},e);d.appendChild(f);h&&d.appendChild(h)},post:function(b,c,a,e,g,d){var h=document,f=null,k=[],n,l=0,m=null,s=0,
r=function(a){s++||e(a)};this.globalEvent(r,g);var q;try{q=h.createElement('<iframe name="'+g+'">')}catch(t){q=h.createElement("iframe")}q.name=g;q.id=g;q.style.display="none";a&&a.callbackonload&&(q.onload=function(){r({response:"posted",message:"Content was posted"})});d&&setTimeout(function(){r({error:{code:"timeout",message:"The post operation timed out"}})},d);h.body.appendChild(q);if(this.domInstance("form",c)){f=c.form;for(l=0;l<f.elements.length;l++)f.elements[l]!==c&&f.elements[l].setAttribute("disabled",
!0);c=f}if(this.domInstance("form",c))for(f=c,l=0;l<f.elements.length;l++)f.elements[l].disabled||"file"!==f.elements[l].type||(f.encoding=f.enctype="multipart/form-data",f.elements[l].setAttribute("name","file"));else{for(m in c)c.hasOwnProperty(m)&&this.domInstance("input",c[m])&&"file"===c[m].type&&(f=c[m].form,f.encoding=f.enctype="multipart/form-data");f||(f=h.createElement("form"),h.body.appendChild(f),n=f);var p;for(m in c)if(c.hasOwnProperty(m))if(a=this.domInstance("input",c[m])||this.domInstance("textArea",
c[m])||this.domInstance("select",c[m]),a&&c[m].form===f)a&&c[m].name!==m&&(c[m].setAttribute("name",m),c[m].name=m);else{d=f.elements[m];if(p)for(d instanceof NodeList||(d=[d]),l=0;l<d.length;l++)d[l].parentNode.removeChild(d[l]);p=h.createElement("input");p.setAttribute("type","hidden");p.setAttribute("name",m);a?p.value=c[m].value:this.domInstance(null,c[m])?p.value=c[m].innerHTML||c[m].innerText:p.value=c[m];f.appendChild(p)}for(l=0;l<f.elements.length;l++)p=f.elements[l],p.name in c||!0===p.getAttribute("disabled")||
(p.setAttribute("disabled",!0),k.push(p))}f.setAttribute("method","POST");f.setAttribute("target",g);f.target=g;f.setAttribute("action",b);setTimeout(function(){f.submit();setTimeout(function(){try{n&&n.parentNode.removeChild(n)}catch(a){try{console.error("HelloJS: could not remove iframe")}catch(b){}}for(var c=0;c<k.length;c++)k[c]&&(k[c].setAttribute("disabled",!1),k[c].disabled=!1)},0)},100)},hasBinary:function(b){for(var c in b)if(b.hasOwnProperty(c)&&this.isBinary(b[c]))return!0;return!1},isBinary:function(b){return b instanceof
Object&&(this.domInstance("input",b)&&"file"===b.type||"FileList"in window&&b instanceof window.FileList||"File"in window&&b instanceof window.File||"Blob"in window&&b instanceof window.Blob)},toBlob:function(b){var c=/^data\:([^;,]+(\;charset=[^;,]+)?)(\;base64)?,/i,a=b.match(c);if(!a)return b;b=atob(b.replace(c,""));for(var c=[],e=0;e<b.length;e++)c.push(b.charCodeAt(e));return new Blob([new Uint8Array(c)],{type:a[1]})}});
(function(b){var c=b.api,a=b.utils;a.extend(a,{dataToJSON:function(a){var b=window,c=a.data;this.domInstance("form",c)?c=this.nodeListToJSON(c.elements):"NodeList"in b&&c instanceof NodeList?c=this.nodeListToJSON(c):this.domInstance("input",c)&&(c=this.nodeListToJSON([c]));if("File"in b&&c instanceof b.File||"Blob"in b&&c instanceof b.Blob||"FileList"in b&&c instanceof b.FileList)c={file:c};if(!("FormData"in b&&c instanceof b.FormData))for(var h in c)c.hasOwnProperty(h)&&("FileList"in b&&c[h]instanceof
b.FileList?1===c[h].length&&(c[h]=c[h][0]):this.domInstance("input",c[h])&&"file"===c[h].type||(this.domInstance("input",c[h])||this.domInstance("select",c[h])||this.domInstance("textArea",c[h])?c[h]=c[h].value:this.domInstance(null,c[h])&&(c[h]=c[h].innerHTML||c[h].innerText)));return a.data=c},nodeListToJSON:function(a){for(var b={},c=0;c<a.length;c++){var h=a[c];!h.disabled&&h.name&&(b[h.name]="file"===h.type?h:h.value||h.innerHTML)}return b}});b.api=function(){var b=a.args({path:"s!",method:"s",
data:"o",timeout:"i",callback:"f"},arguments);b.data&&a.dataToJSON(b);return c.call(this,b)}})(hello);
(function(){function b(a){return function(){var b=a.apply(this,arguments),g=c(function(a,c){b.on("success",a).on("error",c).on("*",function(){var a=Array.prototype.slice.call(arguments);a.unshift(a.pop());d.emit.apply(d,a)})}),d=hello.utils.Event.call(g.proxy);return d}}Function.prototype.bind||(Function.prototype.bind=function(a){function b(){}if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var c=[].slice,d=c.call(arguments,
1),h=this,f=function(){return h.apply(this instanceof b?this:a||window,d.concat(c.call(arguments)))};b.prototype=this.prototype;f.prototype=new b;return f});var c=function(){var a=function(b){if(!(this instanceof a))return new a(b);this.id="Thenable/1.0.6";this.state=0;this.rejectReason=this.fulfillValue=void 0;this.onFulfilled=[];this.onRejected=[];this.proxy={then:this.then.bind(this)};"function"===typeof b&&b.call(this,this.fulfill.bind(this),this.reject.bind(this))};a.prototype={fulfill:function(a){return b(this,
1,"fulfillValue",a)},reject:function(a){return b(this,2,"rejectReason",a)},then:function(b,e){var d=new a;this.onFulfilled.push(h(b,d,"fulfill"));this.onRejected.push(h(e,d,"reject"));c(this);return d.proxy}};var b=function(a,b,e,d){0===a.state&&(a.state=b,a[e]=d,c(a));return a},c=function(a){1===a.state?d(a,"onFulfilled",a.fulfillValue):2===a.state&&d(a,"onRejected",a.rejectReason)},d=function(a,b,c){if(0!==a[b].length){var e=a[b];a[b]=[];a=function(){for(var a=0;a<e.length;a++)e[a](c)};"object"===
typeof process&&"function"===typeof process.nextTick?process.nextTick(a):"function"===typeof setImmediate?setImmediate(a):setTimeout(a,0)}},h=function(a,b,c){return function(e){if("function"!==typeof a)b[c].call(b,e);else{var d;try{d=a(e)}catch(g){b.reject(g);return}f(b,d)}}},f=function(a,b){if(a===b||a.proxy===b)a.reject(new TypeError("cannot resolve promise with itself"));else{var c;if("object"===typeof b&&null!==b||"function"===typeof b)try{c=b.then}catch(e){a.reject(e);return}if("function"===
typeof c){var d=!1;try{c.call(b,function(c){d||(d=!0,c===b?a.reject(new TypeError("circular thenable chain")):f(a,c))},function(b){d||(d=!0,a.reject(b))})}catch(g){d||a.reject(g)}}else a.fulfill(b)}};return a}();hello.login=b(hello.login);hello.api=b(hello.api);hello.logout=b(hello.logout)})(hello);
(function(b){function c(a){a&&"error"in a&&(a.error={code:"server_error",message:a.error.message||a.error})}b.init({dropbox:{login:function(a){},response_type:"code",oauth:{version:"2.0",auth:"https://www.dropbox.com/1/oauth2/authorize",grant:"https://api.dropbox.com/1/oauth2/token"},base:"https://api.dropbox.com/1/",root:"dropbox",get:{audio:"search/auto/?query=.mp3","default":function(a,b){a.path.match("https://api-content.dropbox.com/1/files/")&&(a.method="blob");b(a.path)}},wrap:{me:function(a){c(a);
if(!a.uid)return a;a.name=a.display_name;a.first_name=a.name.split(" ")[0];a.last_name=a.name.split(" ")[1];a.id=a.uid;delete a.uid;delete a.display_name;return a},"default":function(a){c(a);if(a.is_dir&&a.contents){a.data=a.contents;delete a.contents;for(var b=0;b<a.data.length;b++)a.data[b].root=a.root,format_file(a.data[b])}a.is_deleted&&(a.success=!0);return a}},xhr:function(a){if(a.data&&a.data.file){var b=a.data.file;b&&(a.data=b.files?b.files[0]:b)}"delete"===a.method&&(a.method="post");return!0},
form:function(a,b){delete b.state;delete b.redirect_uri}}})})(hello);
(function(b,c){b.init({google:{name:"Google Plus",login:function(a){"none"===a.qs.display&&(a.qs.display="");"code"===a.qs.response_type&&(a.qs.access_type="offline")},oauth:{version:2,auth:"https://accounts.google.com/o/oauth2/auth",grant:"https://accounts.google.com/o/oauth2/token"},scope:{basic:"https://www.googleapis.com/auth/drive.readonly",files:"https://www.googleapis.com/auth/drive.readonly"},scope_delim:" ",base:"https://www.googleapis.com/",get:{audio:"drive/v2/files?q=mimeType contains 'audio/'&fields=items(title,id)"},
wrap:{"default":function(){}},xhr:function(a){if(("post"===a.method||"put"===a.method)&&"object"===typeof a.data)try{a.data=JSON.stringify(a.data),a.headers["content-type"]="application/json"}catch(b){}return!0},form:!1}})})(hello,window);
(function(b){b.init({windows:{name:"Windows live",oauth:{version:2,auth:"https://login.live.com/oauth20_authorize.srf",grant:"https://login.live.com/oauth20_token.srf"},refresh:!0,logout:function(){return"http://login.live.com/oauth20_logout.srf?ts="+(new Date).getTime()},scope:{basic:"wl.skydrive,wl.signin"},base:"https://apis.live.net/v5.0/",get:{audio:"@{parent|me/skydrive}/files?filter=audio,folders",link:"@{parent|me/skydrive}/files?filter=audio,folders"},wrap:{"default":function(b){if("data"in
b)for(var a=0;a<b.data.length;a++){var e=b.data[a];e.picture&&(e.thumbnail=e.picture)}return b}},xhr:function(c){"get"===c.method||"delete"===c.method||b.utils.hasBinary(c.data)||("string"===typeof c.data.file?c.data.file=b.utils.toBlob(c.data.file):(c.data=JSON.stringify(c.data),c.headers={"Content-Type":"application/json"}));return!0},jsonp:function(c){"get"===c.method||b.utils.hasBinary(c.data)||(c.data.method=c.method,c.method="get")}}})})(hello);
(function(b){function c(a){a.id&&(a.picture=a.avatar_url,a.thumbnail=a.avatar_url,a.name=a.username||a.full_name)}function a(a,b){var c=b.access_token;delete b.access_token;b.oauth_token=c;b["_status_code_map[302]"]=200;return!0}b.init({soundcloud:{name:"SoundCloud",oauth:{version:2,auth:"https://soundcloud.com/connect",grant:"https://soundcloud.com/oauth2/token"},base:"https://api.soundcloud.com/",get:{me:"me.json",audio:"me/playlists.json","me/friends":"me/followings.json","me/followers":"me/followers.json",
"me/following":"me/followings.json","default":function(a,b){b(a.path+".json")}},wrap:{me:function(a){c(a);return a},"default":function(a){if(a instanceof Array){a={data:a};for(var b=0;b<a.data.length;b++)c(a.data[b])}"next_href"in a&&(a.paging={next:a.next_href});return a}},xhr:a,jsonp:a}})})(hello);
(function(b){b.init({"4shared":{name:"4shared",response_type:"code",oauth:{version:1,auth:"https://api.4shared.com/v0/oauth/authorize",request:"https://api.4shared.com/v0/oauth/initiate",token:"https://api.4shared.com/v0/oauth/token"},base:"https://api.4shared.com/v0/",get:{me:"user.jsonp",audio:"user/files.jsonp?category=1"}},wrap:{me:function(b){return b},"default":function(b){}},xhr:function(b){if(b.data&&b.data.file){var a=b.data.file;a&&(b.data=a.files?a.files[0]:a)}"delete"===b.method&&(b.method=
"post");return!0},jsonp:function(b,a){var e=a.access_token;delete a.access_token;a.oauth_token=e;return!0}})})(hello);"function"===typeof define&&define.amd&&define(function(){return hello});"object"===typeof module&&module.exports&&(module.exports=hello);
